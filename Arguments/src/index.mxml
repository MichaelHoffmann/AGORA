<?xml version="1.0" encoding="utf-8"?>
<s:Application xmlns:fx="http://ns.adobe.com/mxml/2009" 
			   xmlns:s="library://ns.adobe.com/flex/spark" 
			   xmlns:mx="library://ns.adobe.com/flex/mx" minWidth="955" minHeight="600" applicationComplete="loadData();" xmlns:components="components.*" >
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
	</fx:Declarations>
	<mx:Canvas id="agoraMenu" width="800" height="600" name="agoraMenu">
		<s:VGroup id="Agora">
			<s:HGroup paddingLeft="25" paddingTop="25">
				<s:Label text="Welcome to AGORA...">
				</s:Label>	
			</s:HGroup>
			<s:HGroup id="mainPanel" paddingLeft="25" paddingTop="25" paddingRight="25" paddingBottom="25">
				<s:Panel id="mapList" title="List of Maps" width="200" height="400" >
					<s:VGroup id="mapNameList" gap="5" paddingTop="5" paddingLeft="5"> 
					</s:VGroup>
				</s:Panel>
				<s:Panel id="myMaps" title="My Maps" width="200" height="400">
				</s:Panel>
				<s:Panel  id="projects" title="Projects" width="200" height="400">	
				</s:Panel>
			</s:HGroup>
			<s:HGroup paddingLeft="25" paddingTop="25">
				<s:Button id="createMapBtn" label="Create Map">
				</s:Button >
				<s:Button id="createProjectBtn" label="Create Project">
				</s:Button>
			</s:HGroup>
		</s:VGroup>	
	</mx:Canvas>

	
	<fx:Script>
		<![CDATA[
			import classes.UserData;
			
			import components.LAMWorld;
			import components.LoginWindow;
			
			import mx.controls.Alert;
			import mx.managers.PopUpManager;
			public var username:String;
			public var pass_hash:String;
			
			
			public function createmap():void
			{
				var lamWorld:LAMWorld = new LAMWorld;
				agoraMenu.visible = false;
				addElement(lamWorld);
				
			}
			
			
			public function onVerification(event:Event):void
			{
				createmap();
			}
			
			public function createMap(event:MouseEvent):void
			{
				if(!UserData.isValid())
				{
					var loginWindow:LoginWindow = new LoginWindow;
					PopUpManager.addPopUp(loginWindow,this,true);
					PopUpManager.centerPopUp(loginWindow);
					loginWindow.addEventListener("verification",onVerification);
				}
				else{
					createmap();
				}
			}
			
			public function showMenu():void
			{
				agoraMenu.visible = true;
			}
			
			public function displayMap(event: Event):void
			{
				var xmlData:XML = XML(event.target.data);
				var maps:XMLList = xmlData.map;
				var xmls:Object = new Object;
				for each (var map:XML in maps)
				{
						var mapButton:Button = new Button;
						mapButton.width=190;
						mapButton.label = map.attribute("title");
						mapNameList.addElement(mapButton);
						xmls[mapButton.label] = map;
				}
			}

			private function errorHandler(event:IOErrorEvent):void
			{
				Alert.show("A communication error occurred duing interaction with server");

			}
			
			public function loadMapList():void
			{
				//create a request object
				var request:URLRequest = new URLRequest;
				request.url="http://agora.gatech.edu/dev/list_maps.php";
				request.method = URLRequestMethod.GET;
				
				//create a loader
				var loader:URLLoader = new URLLoader;
				//add a handler for handling the response
				loader.addEventListener(Event.COMPLETE,displayMap);
				loader.addEventListener(IOErrorEvent.IO_ERROR,errorHandler);
				
				
				//load the request obect
				loader.load(request);
				
				//registerEventHandler for createMap
				createMapBtn.addEventListener(MouseEvent.CLICK,createMap);	
			}
			
			public function loadProjectList():void
			{
			
			}
			
			public function loadData():void
			{
				loadMapList();
				loadProjectList();
			}
			
		]]>
	</fx:Script>
</s:Application>
